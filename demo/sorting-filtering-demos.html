<dom-module id="sorting-filtering-demos">
  <template>
    <style>
       :host {
        display: block;
      }

    </style>

    <h3>Sorting</h3>
    <vaadin-demo-snippet id='sorting'>
      <template preserve-content>
        <dom-bind>
          <template is="dom-bind">

            <x-array-data-provider items="{{items}}"></x-array-data-provider>

            <paper-checkbox checked="{{multiSort}}">Enable Multi-Sorting</paper-checkbox>

            <vaadin-grid aria-label="Sorting Example" items="[[items]]" multi-sort="[[multiSort]]">

              <vaadin-grid-column width="50px" flex-grow="0">
                <template class="header">#</template>
                <template preserve-content>[[index]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-sorter path="name.first">First Name</vaadin-grid-sorter>
                </template>
                <template preserve-content>[[item.name.first]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-sorter path="name.last" direction="asc">Last Name</vaadin-grid-sorter>
                </template>
                <template preserve-content>[[item.name.last]]</template>
              </vaadin-grid-column>

            </vaadin-grid>
          </template>
        </dom-bind>
      </template>
    </vaadin-demo-snippet>

    <h3>Sorting with Data Provider</h3>
    <vaadin-demo-snippet id='sorting-with-data-provider'>
      <template preserve-content>
        <x-remote-sorting-example></x-remote-sorting-example>
        <dom-module id="x-remote-sorting-example">
          <template preserve-content>
            <paper-checkbox checked="{{multiSort}}">Enable Multi-Sorting</paper-checkbox>

            <vaadin-grid aria-label="Sorting with Data Provider Example" id="grid" multi-sort="[[multiSort]]">

              <vaadin-grid-column width="50px" flex-grow="0">
                <template class="header">#</template>
                <template preserve-content>[[index]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-sorter path="firstName">First Name</vaadin-grid-sorter>
                </template>
                <template preserve-content>[[item.firstName]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-sorter path="lastName">Last Name</vaadin-grid-sorter>
                </template>
                <template preserve-content>[[item.lastName]]</template>
              </vaadin-grid-column>

            </vaadin-grid>
          </template>
          <script>
            addEventListener('WebComponentsReady', function() {
              Polymer({
                is: 'x-remote-sorting-example',

                ready: function() {
                  var grid = this.$.grid;

                  grid.size = 200;

                  grid.dataProvider = function(params, callback) {
                    var xhr = new XMLHttpRequest();
                    xhr.onload = function() {
                      callback(JSON.parse(xhr.responseText).result);
                    };

                    var index = params.page * params.pageSize;
                    var url = 'https://demo.vaadin.com/demo-data/1.0/people?index=' + index + '&count=' + params.pageSize;

                    // `params.sortOrders` format: [{path: 'lastName', direction: 'asc'}, ...];
                    params.sortOrders.forEach(function(sort) {
                      url += '&orders[]=' + sort.path + ' ' + sort.direction;
                    });

                    xhr.open('GET', url, true);
                    xhr.send();
                  };
                }
              });
            });
          </script>
        </dom-module>
      </template>
    </vaadin-demo-snippet>

    <h3>Filtering</h3>
    <vaadin-demo-snippet id='filtering'>
      <template preserve-content>
        <dom-bind>
          <template is="dom-bind">

            <x-array-data-provider items="{{items}}"></x-array-data-provider>

            <vaadin-grid aria-label="Filtering Example" items="[[items]]">

              <vaadin-grid-column width="50px" flex-grow="0">
                <template class="header">#</template>
                <template preserve-content>[[index]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-filter aria-label="First Name" path="name.first" value="[[_filterFirstName]]">
                    <!--<input placeholder="First Name" value="{{_filterFirstName::input}}" focus-target>-->
                  </vaadin-grid-filter>
                </template>
                <template preserve-content>[[item.name.first]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-filter aria-label="Last Name" path="name.last" value="[[_filterLastName]]">
                    <input placeholder="Last Name" value="{{_filterLastName::input}}" focus-target>
                  </vaadin-grid-filter>
                </template>
                <template preserve-content>[[item.name.last]]</template>
              </vaadin-grid-column>

            </vaadin-grid>
          </template>
        </dom-bind>
      </template>
    </vaadin-demo-snippet>

    <h3>Filtering with Data Provider</h3>
    <vaadin-demo-snippet id='filtering-with-data-provider'>
      <template preserve-content>
        <x-remote-filtering-example></x-remote-filtering-example>
        <dom-module id="x-remote-filtering-example">
          <template preserve-content>
            <vaadin-grid aria-label="Filtering with Data Provider Example" id="grid">

              <vaadin-grid-column width="50px" flex-grow="0">
                <template class="header">#</template>
                <template preserve-content>[[index]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-filter aria-label="Fist Name" path="firstName" value="[[_filterFirstName]]">
                    <input placeholder="First Name" value="{{_filterFirstName::input}}" focus-target>
                  </vaadin-grid-filter>
                </template>
                <template preserve-content>[[item.firstName]]</template>
              </vaadin-grid-column>

              <vaadin-grid-column>
                <template class="header">
                  <vaadin-grid-filter aria-label="Last Name" path="lastName" value="[[_filterLastName]]">
                    <input placeholder="Last Name" value="{{_filterLastName::input}}" focus-target>
                  </vaadin-grid-filter>
                </template>
                <template preserve-content>[[item.lastName]]</template>
              </vaadin-grid-column>

            </vaadin-grid>
          </template>
          <script>
            addEventListener('WebComponentsReady', function() {
              Polymer({
                is: 'x-remote-filtering-example',

                ready: function() {
                  var grid = this.$.grid;

                  grid.size = 200;

                  grid.dataProvider = function(params, callback) {
                    var xhr = new XMLHttpRequest();
                    xhr.onload = function() {
                      var response = JSON.parse(xhr.responseText);

                      // Number of items changes after filtering. We need
                      // to update the grid size based on server response.
                      grid.size = response.size;

                      callback(response.result);
                    };

                    var index = params.page * params.pageSize;
                    var url = 'https://demo.vaadin.com/demo-data/1.0/people?index=' + index + '&count=' + params.pageSize;

                    // `params.filters` format: [{path: 'lastName', direction: 'asc'}, ...];
                    params.filters.forEach(function(filter) {
                      url += '&filters[' + filter.path + ']=' + encodeURIComponent(filter.value);
                    });

                    xhr.open('GET', url, true);
                    xhr.send();
                  };
                }
              });
            });
          </script>
        </dom-module>
      </template>
    </vaadin-demo-snippet>
  </template>
  <script>
    class SortingFilteringDemos extends DemoReadyEventEmitter(GridDemo(Polymer.Element)) {
      static get is() { return 'sorting-filtering-demos' }
    }
    customElements.define(SortingFilteringDemos.is, SortingFilteringDemos);
  </script>
</dom-module>
